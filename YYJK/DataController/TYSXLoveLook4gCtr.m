//
//  TYSXLoveLook4gCtr.m
//  tysx
//
//  Created by zwc on 15/1/4.
//  Copyright (c) 2015年 huangjia. All rights reserved.
//

#import "TYSXLoveLook4gCtr.h"
#import "NSString+JSONCategory.h"

@implementation TYSXLoveLook4gCtr {
    NSMutableArray *loginArray;
    NSMutableArray *playArray;
    NSMutableArray *conversionRateArray;
    NSMutableArray *orderArray;
    NSMutableArray *realTimeTodayArray;
    NSMutableArray *realTimeYesterdayArray;
    NSMutableArray *topTenArray;
    NSMutableArray *topTenNameArray;
    
    int _selectedMainType;
    int _selectedTopTenType;
    NSInteger maxHourValue;
}

- (id)initWithCacheType:(CacheType)cacheType {
    if (self = [super initWithCacheType:cacheType]) {
                _selecteTopTenIndex = 7;
               //NSString *jsonData = @"{\"lpright\":[[\"2015-01-10\",\"C_湖南卫视\",4151,\"C_运动项目样样不精通\",81,\" \",0,\" \",0],[\"2015-01-10\",\" \",0,\"C_十万个冷笑话2第001集超人篇\",47,\" \",0,\" \",0],[\"2015-01-10\",\" \",0,\"C_爸爸去哪儿1011林志颖耍帅玩转拖拉机\",20,\" \",0,\" \",0],[\"2015-01-10\",\" \",0,\"《锋刃》第10集\",14,\" \",0,\" \",0],[\"2015-01-10\",\" \",0,\"C_一号目标\",11,\" \",0,\" \",0],[\"2015-01-10\",\" \",0,\"C_十万个冷笑话2第006集末日篇\",11,\" \",0,\" \",0],[\"2015-01-10\",\" \",0,\"C_我是歌手0117张杰首场表现惊艳\",8,\" \",0,\" \",0],[\"2015-01-10\",\" \",0,\"C_我是歌手纪录片0417歌王双峰会上演强势对决\",7,\" \",0,\" \",0],[\"2015-01-10\",\" \",0,\"C_《满仓进城》第34集\",7,\" \",0,\" \",0],[\"2015-01-10\",\" \",0,\"C_《红高粱》第22集\",7,\" \",0,\" \",0]],\"lptop\":[[\"2015-01-04\",23395,56279,0.4157,0,0,0],[\"2015-01-05\",23257,56266,0.4133,23868,13760,10108],[\"2015-01-05\",23257,56266,0.4133,23868,15667,8201],[\"2015-01-05\",23257,56266,0.4133,23868,16804,7064],[\"2015-01-05\",23257,56266,0.4133,23868,19610,4258],[\"2015-01-05\",23257,56266,0.4133,23868,13760,10108],[\"2015-01-05\",23257,56266,0.4133,23868,18230,5638],[\"2015-01-05\",23257,56266,0.4133,23868,13760,10108],[\"2015-01-05\",23257,56266,0.4133,23868,15667,8201],[\"2015-01-05\",23257,56266,0.4133,23868,19610,4258],[\"2015-01-05\",23257,56266,0.4133,23868,13005,10863],[\"2015-01-05\",23257,56266,0.4133,23868,16804,7064],[\"2015-01-05\",23257,56266,0.4133,23868,12233,11635],[\"2015-01-05\",23257,56266,0.4133,23868,18230,5638],[\"2015-01-05\",23257,56266,0.4133,23868,13760,10108],[\"2015-01-06\",23994,55947,0.4289,23767,4580,19187],[\"2015-01-06\",23994,55947,0.4289,23597,17299,6298],[\"2015-01-06\",23994,55947,0.4289,23597,14344,9253],[\"2015-01-06\",23994,55947,0.4289,23597,18753,4844],[\"2015-01-06\",23994,55947,0.4289,23597,20187,3410],[\"2015-01-06\",23994,55947,0.4289,23767,3050,20717],[\"2015-01-06\",23994,55947,0.4289,23767,3608,20159],[\"2015-01-06\",23994,55947,0.4289,23767,3914,19853],[\"2015-01-06\",23994,55947,0.4289,23767,4126,19641],[\"2015-01-06\",23994,55947,0.4289,23597,7135,16462],[\"2015-01-06\",23994,55947,0.4289,23597,8153,15444],[\"2015-01-06\",23994,55947,0.4289,23597,12761,10836],[\"2015-01-06\",23994,55947,0.4289,23597,16143,7454],[\"2015-01-06\",23994,55947,0.4289,23597,5137,18460],[\"2015-01-06\",23994,55947,0.4289,23597,11789,11808],[\"2015-01-06\",23994,55947,0.4289,23597,10350,13247],[\"2015-01-06\",23994,55947,0.4289,23767,4325,19442],[\"2015-01-06\",23994,55947,0.4289,23597,6028,17569],[\"2015-01-06\",23994,55947,0.4289,23597,15172,8425],[\"2015-01-06\",23994,55947,0.4289,23597,8153,15444],[\"2015-01-07\",22576,54056,0.4176,23326,4340,18986],[\"2015-01-07\",22576,54056,0.4176,23548,14839,8709],[\"2015-01-07\",22576,54056,0.4176,23548,10284,13264],[\"2015-01-07\",22576,54056,0.4176,23326,4578,18748],[\"2015-01-07\",22576,54056,0.4176,23548,5082,18466],[\"2015-01-07\",22576,54056,0.4176,23548,14839,8709],[\"2015-01-07\",22576,54056,0.4176,23548,14839,8709],[\"2015-01-07\",22576,54056,0.4176,23326,3894,19432],[\"2015-01-07\",22576,54056,0.4176,23326,4131,19195],[\"2015-01-07\",22576,54056,0.4176,23548,14091,9457],[\"2015-01-07\",22576,54056,0.4176,23548,14839,8709],[\"2015-01-07\",22576,54056,0.4176,23326,3037,20289],[\"2015-01-07\",22576,54056,0.4176,23326,3638,19688],[\"2015-01-07\",22576,54056,0.4176,23548,12552,10996],[\"2015-01-07\",22576,54056,0.4176,23548,5946,17602],[\"2015-01-07\",22576,54056,0.4176,23548,7004,16544],[\"2015-01-07\",22576,54056,0.4176,23548,8099,15449],[\"2015-01-07\",22576,54056,0.4176,23548,11610,11938],[\"2015-01-07\",22576,54056,0.4176,23548,13370,10178],[\"2015-01-07\",22576,54056,0.4176,23548,14839,8709],[\"2015-01-07\",22576,54056,0.4176,23548,8099,15449],[\"2015-01-08\",21830,54558,0.4001,23625,0,23625],[\"2015-01-08\",21830,54558,0.4001,23275,19792,3483],[\"2015-01-08\",21830,54558,0.4001,23275,0,23275],[\"2015-01-08\",21830,54558,0.4001,23275,9624,13651],[\"2015-01-08\",21830,54558,0.4001,23275,10489,12786],[\"2015-01-08\",21830,54558,0.4001,23275,11462,11813],[\"2015-01-08\",21830,54558,0.4001,23275,14955,8320],[\"2015-01-08\",21830,54558,0.4001,23275,14955,8320],[\"2015-01-08\",21830,54558,0.4001,23625,0,23625],[\"2015-01-08\",21830,54558,0.4001,23625,0,23625],[\"2015-01-08\",21830,54558,0.4001,23625,0,23625],[\"2015-01-08\",21830,54558,0.4001,23625,0,23625],[\"2015-01-08\",21830,54558,0.4001,23275,16548,6727],[\"2015-01-08\",21830,54558,0.4001,23275,14238,9037],[\"2015-01-08\",21830,54558,0.4001,23275,17477,5798],[\"2015-01-08\",21830,54558,0.4001,23625,0,23625],[\"2015-01-08\",21830,54558,0.4001,23275,12706,10569],[\"2015-01-08\",21830,54558,0.4001,23275,13525,9750],[\"2015-01-08\",21830,54558,0.4001,23625,0,23625],[\"2015-01-08\",21830,54558,0.4001,23275,18581,4694],[\"2015-01-08\",21830,54558,0.4001,23275,0,23275],[\"2015-01-09\",23517,58907,0.3992,22800,13002,9798],[\"2015-01-09\",23517,58907,0.3992,22800,15566,7234],[\"2015-01-09\",23517,58907,0.3992,23285,5291,17994],[\"2015-01-09\",23517,58907,0.3992,22800,9919,12881],[\"2015-01-09\",23517,58907,0.3992,22800,11317,11483],[\"2015-01-09\",23517,58907,0.3992,22800,12241,10559],[\"2015-01-09\",23517,58907,0.3992,22800,13719,9081],[\"2015-01-09\",23517,58907,0.3992,22800,18058,4742],[\"2015-01-09\",23517,58907,0.3992,23285,4245,19040],[\"2015-01-09\",23517,58907,0.3992,22800,13719,9081],[\"2015-01-09\",23517,58907,0.3992,23285,3479,19806],[\"2015-01-09\",23517,58907,0.3992,23285,4846,18439],[\"2015-01-09\",23517,58907,0.3992,22800,6058,16742],[\"2015-01-09\",23517,58907,0.3992,22800,7843,14957],[\"2015-01-09\",23517,58907,0.3992,22800,16690,6110],[\"2015-01-09\",23517,58907,0.3992,22800,19581,3219],[\"2015-01-09\",23517,58907,0.3992,23285,3952,19333],[\"2015-01-09\",23517,58907,0.3992,23285,4435,18850],[\"2015-01-09\",23517,58907,0.3992,22800,6944,15856],[\"2015-01-09\",23517,58907,0.3992,22800,7843,14957],[\"2015-01-09\",23517,58907,0.3992,23285,4435,18850],[\"2015-01-10\",17223,63754,0.2701,22203,4609,17594],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22203,4863,17340],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22203,3547,18656],[\"2015-01-10\",17223,63754,0.2701,22203,4215,17988],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22203,5357,16846],[\"2015-01-10\",17223,63754,0.2701,22203,5895,16308],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22641,6924,15717],[\"2015-01-10\",17223,63754,0.2701,22203,4863,17340]],\"dgright\":[[\"2015-01-10\",\"爱看4G客户端预装渠道_客户端预装_天翼视讯\",6,\"C_女体宴\",2,\"百视通\",5],[\"2015-01-10\",\"天翼视讯运营_腾讯应用宝爱看4G推广_天翼视讯（爱看4G）\",3,\"C_湖南卫视\",1,\"央广视讯\",3],[\"2015-01-10\",\"天翼视讯运营_华为智汇云爱看4G推广_天翼视讯（爱看4G）\",2,\"C_大本营1213魏晨飙泪电话初恋情系匆匆那年\",1,\"芒果TV\",3],[\"2015-01-10\",\"视讯推广_安智市场新客户端_天翼视讯\",2,\"C_《镖门》第35集\",1,\"环球时报\",2],[\"2015-01-10\",\"天翼视讯运营_号百CPA114广告联盟导航类新客户端推广1_天翼视讯\",1,\"C_最强大脑第二季0109舒淇综艺首秀智商130\",1,\"CCTV\",1],[\"2015-01-10\",\"天翼视讯运营_安智市场爱看4G推广_天翼视讯（爱看4G）\",1,\"C_《清网行动》第1集\",1,\"优酷\",1],[\"2015-01-10\",\"天翼视讯运营_明昊CPA爱看4G推广1_天翼视讯（爱看4G）\",1,\"C_林心如狠呛于正：是男人说清楚\",1,\"视讯中国\",1],[\"2015-01-10\",\"天翼视讯运营_4X升级新客户端推广_天翼视讯\",1,\"《赛罗奥特曼》超银河传说\",1,\"华数传媒\",1],[\"2015-01-10\",\" \",0,\"C_大头儿子和小头爸爸2第001集迎新年\",1,\" \",0],[\"2015-01-10\",\" \",0,\"天天向上0613特色美女引主持人内讧\",1,\" \",0]],\"dgleft\":[[1,72,79],[2,0,41],[3,0,33],[4,0,18],[5,0,23],[6,0,40],[7,0,58],[8,0,101],[9,0,109],[10,0,110],[11,0,128],[12,0,112],[13,0,184],[14,0,125],[15,0,121],[16,0,134],[17,0,155],[18,147,123],[19,0,235],[20,0,184],[21,0,252],[22,0,223],[23,0,149]],\"dgtop\":[[\"2015-01-04\",1380,0,0,0],[\"2015-01-05\",1242,1520,533,987],[\"2015-01-05\",1242,1520,578,942],[\"2015-01-05\",1242,1520,636,884],[\"2015-01-05\",1242,1520,806,714],[\"2015-01-05\",1242,1520,487,1033],[\"2015-01-05\",1242,1520,700,820],[\"2015-01-05\",1242,1520,533,987],[\"2015-01-05\",1242,1520,578,942],[\"2015-01-05\",1242,1520,806,714],[\"2015-01-05\",1242,1520,437,1083],[\"2015-01-05\",1242,1520,636,884],[\"2015-01-05\",1242,1520,393,1127],[\"2015-01-05\",1242,1520,700,820],[\"2015-01-05\",1242,1520,487,1033],[\"2015-01-06\",1225,1440,123,1317],[\"2015-01-06\",1225,1374,695,679],[\"2015-01-06\",1225,1374,506,868],[\"2015-01-06\",1225,1374,778,596],[\"2015-01-06\",1225,1374,890,484],[\"2015-01-06\",1225,1440,0,1440],[\"2015-01-06\",1225,1440,53,1387],[\"2015-01-06\",1225,1440,88,1352],[\"2015-01-06\",1225,1440,109,1331],[\"2015-01-06\",1225,1374,181,1193],[\"2015-01-06\",1225,1374,252,1122],[\"2015-01-06\",1225,1374,399,975],[\"2015-01-06\",1225,1374,632,742],[\"2015-01-06\",1225,1374,133,1241],[\"2015-01-06\",1225,1374,334,1040],[\"2015-01-06\",1225,1374,292,1082],[\"2015-01-06\",1225,1440,117,1323],[\"2015-01-06\",1225,1374,151,1223],[\"2015-01-06\",1225,1374,561,813],[\"2015-01-06\",1225,1374,215,1159],[\"2015-01-07\",1172,1311,119,1192],[\"2015-01-07\",1172,1282,661,621],[\"2015-01-07\",1172,1282,295,987],[\"2015-01-07\",1172,1311,128,1183],[\"2015-01-07\",1172,1282,148,1134],[\"2015-01-07\",1172,1282,735,547],[\"2015-01-07\",1172,1282,811,471],[\"2015-01-07\",1172,1311,81,1230],[\"2015-01-07\",1172,1311,105,1206],[\"2015-01-07\",1172,1282,497,785],[\"2015-01-07\",1172,1282,548,734],[\"2015-01-07\",1172,1311,0,1311],[\"2015-01-07\",1172,1311,44,1267],[\"2015-01-07\",1172,1282,392,890],[\"2015-01-07\",1172,1282,164,1118],[\"2015-01-07\",1172,1282,188,1094],[\"2015-01-07\",1172,1282,259,1023],[\"2015-01-07\",1172,1282,331,951],[\"2015-01-07\",1172,1282,445,837],[\"2015-01-07\",1172,1282,548,734],[\"2015-01-07\",1172,1282,214,1068],[\"2015-01-08\",1178,1233,0,1233],[\"2015-01-08\",1178,1213,744,469],[\"2015-01-08\",1178,1213,151,1062],[\"2015-01-08\",1178,1213,178,1035],[\"2015-01-08\",1178,1213,212,1001],[\"2015-01-08\",1178,1213,254,959],[\"2015-01-08\",1178,1213,430,783],[\"2015-01-08\",1178,1213,471,742],[\"2015-01-08\",1178,1233,69,1164],[\"2015-01-08\",1178,1233,79,1154],[\"2015-01-08\",1178,1233,92,1141],[\"2015-01-08\",1178,1233,115,1118],[\"2015-01-08\",1178,1213,516,697],[\"2015-01-08\",1178,1213,388,825],[\"2015-01-08\",1178,1213,578,635],[\"2015-01-08\",1178,1233,46,1187],[\"2015-01-08\",1178,1213,296,917],[\"2015-01-08\",1178,1213,347,866],[\"2015-01-08\",1178,1233,104,1129],[\"2015-01-08\",1178,1213,665,548],[\"2015-01-08\",1178,1213,126,1087],[\"2015-01-09\",1179,1191,410,781],[\"2015-01-09\",1179,1191,579,612],[\"2015-01-09\",1179,1198,111,1087],[\"2015-01-09\",1179,1191,260,931],[\"2015-01-09\",1179,1191,304,887],[\"2015-01-09\",1179,1191,363,828],[\"2015-01-09\",1179,1191,459,732],[\"2015-01-09\",1179,1191,700,491],[\"2015-01-09\",1179,1198,67,1131],[\"2015-01-09\",1179,1191,410,781],[\"2015-01-09\",1179,1198,0,1198],[\"2015-01-09\",1179,1198,108,1090],[\"2015-01-09\",1179,1191,121,1070],[\"2015-01-09\",1179,1191,217,974],[\"2015-01-09\",1179,1191,642,549],[\"2015-01-09\",1179,1191,788,403],[\"2015-01-09\",1179,1198,36,1162],[\"2015-01-09\",1179,1198,101,1097],[\"2015-01-09\",1179,1191,142,1049],[\"2015-01-09\",1179,1191,170,1021],[\"2015-01-09\",1179,1198,85,1113],[\"2015-01-10\",1319,1175,101,1074],[\"2015-01-10\",1319,1176,1026,150],[\"2015-01-10\",1319,1176,312,864],[\"2015-01-10\",1319,1176,579,597],[\"2015-01-10\",1319,1176,769,407],[\"2015-01-10\",1319,1176,847,329],[\"2015-01-10\",1319,1175,121,1054],[\"2015-01-10\",1319,1176,367,809],[\"2015-01-10\",1319,1175,0,1175],[\"2015-01-10\",1319,1175,61,1114],[\"2015-01-10\",1319,1176,258,918],[\"2015-01-10\",1319,1176,642,534],[\"2015-01-10\",1319,1175,147,1028],[\"2015-01-10\",1319,1175,158,1017],[\"2015-01-10\",1319,1176,207,969],[\"2015-01-10\",1319,1176,431,745],[\"2015-01-10\",1319,1176,702,474],[\"2015-01-10\",1319,1176,908,268],[\"2015-01-10\",1319,1176,178,998],[\"2015-01-10\",1319,1176,487,689],[\"2015-01-10\",1319,1175,138,1037]],\"lpleft\":[[0,38889,5248],[1,24394,3267],[2,18217,1985],[3,10631,1395],[4,8394,1187],[5,8489,1266],[6,12953,2159],[7,24146,4192],[8,41767,7161],[9,43928,6895],[10,42465,6518],[11,45286,6877],[12,48786,7293],[13,45051,6683],[14,44763,6377],[15,43191,6193],[16,43334,6394],[17,45912,6914],[18,50074,7278],[19,63365,9555],[20,70477,9784],[21,80397,11231],[22,0,0],[23,0,0]]}";
       //responeData = [jsonData JSONValue];
    }
    return self;
}

- (id)init {
    if (self = [super init]) {
//        for (int j = 0; j < 4; j++) {
//            printf("case %d:\nret = @[", j);
//            for (int i = 0; i < 10; i++) {
//                if (i != 9) {
        //                    printf("@%d, ", arc4random() % 200 + 400);
        //                }
        //                else {
        //                    printf("@%d];\nbreak;\n", arc4random() % 200 + 400);
        //                }
        //            }
        //        }
        printf("return @[");
        for (int i = 0; i < 24; i++) {
            if (i == 23) {
                printf("@%d];", arc4random() % 300);
            }
            else {
                printf("@%d, ", arc4random() % 300);
            }
        }
    }
    return self;
}

- (void)allocDataContainer {
    realTimeTodayArray = [NSMutableArray array];
    realTimeYesterdayArray = [NSMutableArray array];
    loginArray = [NSMutableArray array];
    playArray = [NSMutableArray array];
    conversionRateArray = [NSMutableArray array];
    orderArray = [NSMutableArray array];
    topTenNameArray = [NSMutableArray array];
    topTenArray = [NSMutableArray array];
}

- (void)clearDataContainer {
    [realTimeYesterdayArray removeAllObjects];
    [realTimeTodayArray removeAllObjects];
    [loginArray removeAllObjects];
    [playArray removeAllObjects];
    [conversionRateArray removeAllObjects];
    [orderArray removeAllObjects];
}

- (void)reloadTopTenData {
    [topTenArray removeAllObjects];
    [topTenNameArray removeAllObjects];
    topTenNameArray = [@[@"", @"", @"", @"", @"", @"", @"", @"", @"", @""] mutableCopy];
    topTenArray = [@[@0, @0, @0, @0, @0, @0, @0, @0, @0, @0] mutableCopy];
    NSArray *dataList = nil;
    NSDictionary *dataDic = (NSDictionary *)responeData;
    if (_selectedMainType == 0) {
        dataList = dataDic[@"lpright"];
    }
    else {
        dataList = dataDic[@"dgright"];
    }
    
    NSDate *selecteDate = [NSDate dateWithTimeInterval:-3600 * 24 * (8 - _selecteTopTenIndex) sinceDate:lastDate];
    NSString *selectedDateString = stringWithDate(selecteDate);
    
    NSInteger currentReplaceIndex = 0;
    for (int i = 0; i < [dataList count]; i++) {
        NSArray *cellData = dataList[i];
        if ([cellData[0] isEqualToString:selectedDateString]) {
            [topTenNameArray replaceObjectAtIndex:currentReplaceIndex withObject:cellData[_selectedTopTenType * 2 + 1]];
            [topTenArray replaceObjectAtIndex:currentReplaceIndex withObject:cellData[_selectedTopTenType * 2 + 2]];
            currentReplaceIndex++;
        }
    }
}

- (void)reloadRealData {
    NSDictionary *dataDic = (NSDictionary *)responeData;
    
    NSString *dataKey = nil;
    if (_selectedMainType == 0) {
        dataKey = @"lpleft";
    }
    else {
        dataKey = @"dgleft";
    }
    
    NSArray *realTimeData = [dataDic objectForKey:dataKey];
    realTimeTodayArray = [@[@0, @0, @0, @0,@0, @0, @0, @0,@0, @0, @0, @0,@0, @0, @0, @0,@0, @0, @0, @0,@0, @0, @0, @0] mutableCopy];
    realTimeYesterdayArray = [@[@0, @0, @0, @0,@0, @0, @0, @0,@0, @0, @0, @0,@0, @0, @0, @0,@0, @0, @0, @0,@0, @0, @0, @0] mutableCopy];
    maxHourValue = 0;
    for (int i = 0; i < [realTimeData count]; i++) {
        NSArray *cellData = realTimeData[i];
        int index = [cellData[1] intValue];
        if ([cellData[0] isEqualToString:self.lastDateStr]) {
            [realTimeTodayArray replaceObjectAtIndex:index withObject:cellData[2]];
            maxHourValue = MAX(maxHourValue, index);
        }
        else {
            [realTimeYesterdayArray replaceObjectAtIndex:index withObject:cellData[2]];
        }
    }
    maxHourValue += 1;
}

- (void)reloadData {
    [super reloadData];
    NSDictionary *dataDic = (NSDictionary *)responeData;
    loginArray = [@[@0, @0, @0, @0,@0, @0, @0, @0, @0] mutableCopy];
    playArray = [@[@0, @0, @0, @0,@0, @0, @0, @0, @0] mutableCopy];
    conversionRateArray = [@[@0, @0, @0, @0,@0, @0, @0, @0,@0] mutableCopy];
    NSArray *leftTopData = [dataDic objectForKey:@"lptop"];
    
    NSDateFormatter *dateFormat = [[NSDateFormatter alloc] init];
    [dateFormat setDateFormat:@"yyyy-MM-dd"];
    
    for (int i = 0; i < [leftTopData count]; i++) {
        NSArray *cellData = leftTopData[i];
        int index = 8 - ([[dateFormat dateFromString:self.lastDateStr] timeIntervalSince1970] - [[dateFormat dateFromString:cellData[0]] timeIntervalSince1970]) / 3600 / 24;
        if (index < 0 || index > 8) {
            continue;
        }
        [loginArray replaceObjectAtIndex:index withObject:cellData[2]];
        [playArray replaceObjectAtIndex:index withObject:cellData[1]];
        [conversionRateArray replaceObjectAtIndex:index withObject:cellData[3]];
    }
    
    orderArray = [@[@0, @0, @0, @0,@0, @0, @0, @0,@0] mutableCopy];
    NSArray *rightTopData = [dataDic objectForKey:@"dgtop"];
    
    for (int i = 0; i < [rightTopData count]; i++) {
        NSArray *cellData = rightTopData[i];
        int index = 8 - ([[dateFormat dateFromString:self.lastDateStr] timeIntervalSince1970] - [[dateFormat dateFromString:cellData[0]] timeIntervalSince1970]) / 3600 / 24;
        if (index < 0 || index > 8) {
            continue;
        }
        [orderArray replaceObjectAtIndex:index withObject:cellData[1]];
    }
    [self reloadTopTenData];
    [self reloadRealData];
}

- (void)setSelectedMainType:(int)selectedMainType {
    if (_selectedMainType != selectedMainType) {
        _selectedMainType = selectedMainType;
        _selectedTopTenType = 0;
        [self reloadTopTenData];
        [self reloadRealData];
    }
}

- (void)setSelectedTopTenType:(int)selectedTopTenType {
    if (_selectedTopTenType != selectedTopTenType) {
        _selectedTopTenType = selectedTopTenType;
        [self reloadTopTenData];
    }
}

- (void)setSelecteTopTenIndex:(NSInteger)selecteTopTenIndex {
    if (_selecteTopTenIndex != selecteTopTenIndex) {
        _selecteTopTenIndex = selecteTopTenIndex;
        [self reloadTopTenData];
    }
}

- (NSArray *)topTenTypeNameList {
    NSArray *ret = nil;
    switch (_selectedMainType) {
        case 0:
            ret = @[@"直播", @"点播", @"回看", @"下载"];
            break;
        case 1:
            ret = @[@"渠道", @"节目", @"CP"];
            break;
        default:
            break;
    }
    return ret;
}

- (NSInteger)maxHour {
    if (kNeedVirtualData) {
        return 13;
    }
    return maxHourValue;
}

- (NSArray *)loginData {
    if (kNeedVirtualData) {
        return @[@152, @165, @5, @31, @212, @112, @265, @201, @159];
    }
    return loginArray;
}

- (NSArray *)playData {
    if (kNeedVirtualData) {
        return @[@176, @96, @10, @40, @244, @183, @162, @117, @131];
    }
    return playArray;
}

- (NSArray *)orderData {
    if (kNeedVirtualData) {
        return @[@127, @63, @298, @223, @122, @262, @41, @6, @95];
    }
    return orderArray;
}

- (NSArray *)conversionRateData {
    if (kNeedVirtualData) {
        return @[@0.2, @0.3, @0.15, @0.24, @0.5, @0.8, @0.7, @0.38, @0.13];
    }
    return conversionRateArray;
}

- (NSArray *)realTimeTodayData {
    if (kNeedVirtualData) {
        return @[@41, @111, @209, @213, @243, @177, @215, @263, @289, @113, @288, @217, @275, @90, @2, @107, @112, @120, @297, @217, @51, @1, @186, @37];
    }
    return realTimeTodayArray;
}

- (NSArray *)realTimeYesterdayData {
    if (kNeedVirtualData) {
        return @[@123, @239, @179, @115, @285, @236, @6, @147, @218, @73, @6, @91, @190, @282, @212, @173, @121, @280, @222, @73, @90, @289, @294, @22];
    }
    return realTimeYesterdayArray;
}

- (NSArray *)topTenNameList {
    return @[@"项目一", @"项目二", @"项目三", @"项目四", @"项目五", @"项目六", @"项目七", @"项目八", @"项目九", @"项目十"];
    return topTenNameArray;
}

- (NSArray *)topTenData {
    NSArray *ret = nil;
    if (kNeedVirtualData) {
        if (_selectedMainType) {
            switch (_selectedTopTenType) {
                case 0:
                    ret = @[@458, @551, @441, @556, @599, @537, @543, @585, @496, @561];
                    break;
                case 1:
                    ret = @[@570, @404, @508, @538, @416, @478, @542, @598, @419, @475];
                    break;
                case 2:
                    ret = @[@580, @524, @488, @544, @448, @475, @435, @454, @441, @498];
                    break;
                case 3:
                    ret = @[@558, @546, @481, @573, @453, @412, @432, @444, @419, @405];
                    break;
                default:
                    break;
            }
        }
        else {
            switch (_selectedTopTenType) {
                case 0:
                    ret = @[@521, @456, @540, @483, @435, @580, @513, @443, @411, @428];
                    break;
                case 1:
                    ret = @[@506, @598, @576, @489, @465, @424, @446, @516, @560, @427];
                    break;
                case 2:
                    ret = @[@505, @426, @478, @589, @555, @505, @413, @401, @517, @419];
                    break;
                case 3:
                    ret = @[@585, @462, @440, @435, @454, @405, @478, @484, @569, @550];
                    break;
                default:
                    break;
            }
        }
        return [ret sortedArrayUsingComparator:^NSComparisonResult(id obj1, id obj2) {
            return obj1 < obj2;
        }];
    }
    else {
        return topTenArray;
    }
}

+ (NSString *)path {
    return @"/chartsAction!getData.ds";
}

- (NSDictionary *)configParams {
    startDateStr = stringWithDate([NSDate dateWithTimeIntervalSinceNow:-24 * 3600 * 8]);
    endDateStr = stringWithDate([NSDate dateWithTimeIntervalSinceNow:0]);
    willShowDate = [NSDate dateWithTimeIntervalSinceNow:0];
    return @{@"dtype":@4,
             @"sdate":startDateStr,
             @"edate":endDateStr};
}

- (void)successWithResponse:(id)responseObject {
    _resultInfo = @"该天无网络数据";
    NSDictionary *responseDic = (NSDictionary *)responseObject;
    lastDate = willShowDate;
    _result = NetworkBaseResult_Success;
    _resultInfo = @"成功获取网络数据";
    responeData = responseDic;
}

@end
